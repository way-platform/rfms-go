# FMS API Authentication

Source: https://developer.scania.com/doc/api-authentication/fms (fetched on 2025-04-26)

## Introduction

## Audience

You need to read this if:

- You are an existing consumer of Scania Data Access APIs since you will then need to migrate to the new endpoints.
- You are a registered developer and wants to start building apps on top of Scania Data Access APIs.

## Overview

Scania recognizes the importance of Data Protection, and we need to ensure GDPR compliance for both Scania and our customers and since basic authentication is not recommended anymore according to GDPR, a decision to migrate to a new authentication mechanism (OAuth 2.0) has been taken for all Scania services including the services being consumed by our customers for integration purposes.

The following FMS APIs are protected by API token.

- rFMS Standard 4.0 APIs
- rFMS Standard 2.1 APIs
- rFMS Standard 1.x APIs
- Scania APIs

## OAuth 2.0

Scania uses OAuth 2.0 to authenticate connections that use the data access APIs. OAuth 2.0 is an open protocol for authentication used with web, mobile, and desktop applications. Every use of Data Access APIs requires authentication to ensure that only authorized consumers can retrieve the customers data.

## Get Authenticated

As a prerequisite to obtain a token, each consumer needs to obtain access keys (Client Id and Secret key) by creating an client in the developer portal.

If you are an existing consumer then you can login to the portal using your _Data Access_ (old account type which will be removed) or _FMS Developer_ (new account type) user credentials, that were given to you by your nearest Scania dealer and currently used to authenticate with the existing APIs. If you do not have these credentials then you can ask your Scania representative for them.

If you are a developer who wants access to test data for the purpose of building services for our customers on top of Data Access APIs, then you can register through the developer portal, create an client and get your keys _(These key grants you access to test data only)_.

## Test data

Test data is a pre-defined dataset generated for test purposes and not really collected from real vehicles.

## Obtain Client Id and Secret key

The Client ID and Secret key can be obtained by creating a client, which will ask you to provide a name and description so we know what kind of integration is intended.

 I want to create a client

Once the client is created, Client Id and Secret key will be generated for you, those keys are used to obtain access token to consume the Data Access APIs.

Please make sure not to share these keys to avoid unauthorized access to your data.

## When logged in as Test user

The client that you create when logged in using Test user account, will provide you the Client ID and Secret key for accessing our test data only.

## When logged in as FMS Developer user

The client that you create when logged in using FMS Developer user account, will provide you the Client ID and Secret key for accessing the data for which you have the subscription.

Once you have the Client ID and Secret key, the API token can be generated by following steps below.


According to security recommendations Data Access APIs uses challenge-response verification before obtaining a token to avoid sending the secret key through wires.

Step 1: Get Challenge

Step 2: Create Challenge response

Step 3: Get Token

## Step 1: Get Challenge

First step is to obtain _Challenge_. This is can be done by passing _Client ID_ to the token end-point as described below.

## Request

```
POST https://dataaccess.scania.com/auth/clientid2challenge
```

### Request content type

```
application/x-www-form-urlencoded
```

### Request body

Example

```
clientId=uGx2pdCQQCuj12Pl4myk40g2fuLQXXHFADCkVfhQrbPAfteRw0-BnN6qVHs5rRtbXURR9Xf_7I31SgDI0mI-sQ
```

## Response

### Response content type

```
application/json
```

Example

```
{"challenge": "W5x6NvbIovwvmPGG0Q4IvqJyDAdQ3nNgiDy59tUbQpQ"}
```

## Step 2: Create Challenge Response

Next step is to create _Challenge Response_. Use the following logic to create _Challenge Response_ from _Secret key_ and _Challenge_. The source code given below is in multiple languages.

- C#
- Visual Basic
- JavaScript
- PHP
- Python
- Java

```csharp
var challengeResponse = await CreateChallengeResponse(CurrentSecret, challenge);

public async static Task<string> CreateChallengeResponse(string secretKey, string challenge)
{
  var sharedKeyArr = Base64Url.Decode(secretKey);
  var challengeArr = Base64Url.Decode(challenge);
  byte[] challengeResponse = null;
  using (HMACSHA256 hmac = new HMACSHA256(sharedKeyArr))
  {
    challengeResponse = hmac.ComputeHash(challengeArr);
  }
  return Base64Url.Encode(challengeResponse);
}

public static class Base64Url
{
  public static string Encode(byte[] arg)
  {
    string s = Convert.ToBase64String(arg);
    s = s.Split('=')[0];
    s = s.Replace('+','-');
    s = s.Replace('/','_');
    return s;
  }
  public static byte[] Decode(string arg)
  {
    string s = arg;
    s = s.Replace('-','+');
    s = s.Replace('_','/');

    switch (s.Length % 4)
    {
      case 0: break;
      case 2: s += "=="; break;
      case 3: s += "="; break;
      default: throw new Exception("Illegal base64Url string");
    }
    return Convert.FromBase64String(s);
  }
}
```

## Step 3: Get Token

Finally, API token can be obtained by calling the Response2Token endpoint using the _Client ID_ and _Challenge Response_ obtained from previous steps. The endpoint response contains both token and refresh token. The refresh token can be used to obtain a new token without going through steps 1 and 2 again.

## Request

```
POST https://dataaccess.scania.com/auth/response2token
```

### Request content type

```
application/x-www-form-urlencoded
```

### Request body

Example

```
clientId=uGx2pdCQQCuj12Pl4myk40g2fuLQXXHFADCkVfhQrbPAfteRw0-BnN6qVHs5rRtbXURR9Xf_7I31SgDI0mI-sQ&Response=q7YM5GSG2z01TYDDPUl5iGsTQLM8W-su5TckEX7LDXY
```

## Response

### Response content type

```
application/json
```

Example

```
{"token": "ZHO4jwIKZtI1n2l9jkKzSDo"     "refreshToken": "2f18280570c44bbbb0263472e819404c"}
```

The generated token can be used for making authorized calls to the Data Access APIs by adding it to the Authorization header.

The following example shows how to make authorized call to _LastResported_ API using a token:

```
curl --header "Authorization: Bearer ZHO4jwIKZtI1n2l9jkKzSDo" https://dataaccess.scania.com/cs/vehicle/position/LastReported/v1?vinOfInterest=vinOfInterest
```

---

## Refresh Token

Each token has an hour expiry and refresh token can be used to obtain a new one without going through steps 1 and 2 described above. The RefreshToken endpoint can be used for obtaining new token using the refresh token as following:

## Request

```
POST https://dataaccess.scania.com/auth/refreshtoken
```

### Request content type

```
application/x-www-form-urlencoded
```

### Request body

Example

```
clientId=uGx2pdCQQCuj12Pl4myk40g2fuLQXXHFADCkVfhQrbPAfteRw0-BnN6qVHs5rRtbXURR9Xf_7I31SgDI0mI-sQ&RefreshToken=2f18280570c44bbbb0263472e819404c
```

## Response

### Response content type

```
application/json
```

Example

```
{"token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9"     "refreshToken": "ODk0OTkiLCJjbGllbnRJZCI6IktGa3NnemZ6YjB"}
```

Refresh token validity is 24 hours.

Notice that each time you obtain a token using the RefreshToken endpoint, you get a new refresh token and the old one becomes invalid. Always use the latest refresh token when calling RefreshToken endpoint, otherwise you will get invalid refresh token error.
